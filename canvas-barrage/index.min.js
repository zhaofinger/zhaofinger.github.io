"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),Barrage=function(){function t(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;_classCallCheck(this,t),this.ctx=e.getContext("2d"),this.ctx.font="30px \u5fae\u8f6f\u96c5\u9ed1",this.width=e.width,this.height=e.height,this.msgs=new Array(s),this.msgStackLength=s,this.intervalId="",this.quality=i}return _createClass(t,[{key:"_getLimitRandom",value:function(t,e){return Math.floor(Math.random()*(e-t)+t)}},{key:"_getRandomColor",value:function(){var t=["00","33","66","99","cc","ff"],e=t.length;return"#"+t[this._getLimitRandom(0,e)]+t[this._getLimitRandom(0,e)]+t[this._getLimitRandom(0,e)]}},{key:"_draw",value:function(){var t=this;this.intervalId||(this.intervalId=setInterval(function(){t.ctx.clearRect(0,0,t.width,t.height),t.ctx.save();for(var e=0,s=0;s<t.msgStackLength;s++)if(t.msgs[s])if(t.msgs[s].left||"number"==typeof t.msgs[s].left)if(t.msgs[s].left<0-t.msgs[s].width)t.msgs[s]=null;else{t.msgs[s].left=parseInt(t.msgs[s].left-t.msgs[s].speed),t.ctx.fillStyle=t.msgs[s].color,t.ctx.fillText(t.msgs[s].text,t.msgs[s].left,t.msgs[s].top);var i=t.ctx.measureText(t.msgs[s].text);t.msgs[s].width=i.width,t.ctx.restore}else t.msgs[s].left=t.width,t.msgs[s].top=t.msgs[s].top||t._getLimitRandom(30,t.height-30),t.msgs[s].speed=t.msgs[s].speed||t._getLimitRandom(2,4),t.msgs[s].color=t.msgs[s].color||t._getRandomColor();else(e+=1)===t.msgStackLength&&clearInterval(t.intervalId)},this.quality))}},{key:"pushMessage",value:function(t){for(var e=0;e<this.msgStackLength;e++)if(!this.msgs[e]){this.msgs[e]=t;break}this._draw()}},{key:"clear",value:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=""),this.ctx.clearRect(0,0,this.width,this.height),this.msgs=this.msgs.map(function(t){return null})}}]),t}();