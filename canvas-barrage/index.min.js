"use strict";var _createClass=function(){function e(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}!function(){console.log("polyfill");for(var a=0,t=["webkit","moz"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var s=(new Date).getTime(),e=Math.max(0,16.7-(s-a)),n=window.setTimeout(function(){t(s+e)},e);return a=s+e,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Barrage=function(){function o(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10;_classCallCheck(this,o),this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,this.msgs=new Array(i),this.msgStackLength=i,this.fontSize=s,this.requestAnimationFrameId=null,this.isRunning=!1,this.isClose=!1;var e=(window.devicePixelRatio||1)/(this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1);this.ratio=e;var n=t.width,a=t.height;t.width=n*e,t.height=a*e,t.style.width=n+"px",t.style.height=a+"px",this.ctx.scale(e,e),this.ctx.font=s+'px "PingFang SC", "Microsoft JhengHei", "Microsoft YaHei", "sans-serif"',this.ctx.shadowBlur=4}return _createClass(o,[{key:"_getLimitRandom",value:function(t,i){return Math.floor(Math.random()*(i-t)+t)}},{key:"_getRandomColor",value:function(){var t=["00","33","66","99","cc","ff"],i=t.length;return"#"+t[this._getLimitRandom(0,i)]+t[this._getLimitRandom(0,i)]+t[this._getLimitRandom(0,i)]}},{key:"_draw",value:function(){var e=this;this.ctx.clearRect(0,0,this.width,this.height),this.ctx.save();for(var t=0,i=0;i<this.msgStackLength;i++)if(this.msgs[i])if(this.isRunning=!0,this.msgs[i].left||"number"==typeof this.msgs[i].left)if(this.msgs[i].left<0-this.msgs[i].width)this.msgs[i]=null;else{this.msgs[i].left=this.msgs[i].left-this.msgs[i].speed,this.ctx.shadowColor=this.msgs[i].color,this.ctx.fillStyle=this.msgs[i].color,this.ctx.font=this.ctx.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,i,s){return i*e.ratio+s}),this.ctx.fillText(this.msgs[i].text,this.msgs[i].left,this.msgs[i].top),this.ctx.font=this.ctx.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,i,s){return i/e.ratio+s});var s=this.ctx.measureText(this.msgs[i].text);this.msgs[i].width=s.width*this.ratio,this.ctx.restore}else this.msgs[i].left=this.width,this.msgs[i].top=this.msgs[i].top||this._getLimitRandom(30,this.height-30),this.msgs[i].speed=this.msgs[i].speed||this._getLimitRandom(0,2)+parseInt(this.fontSize/10),this.msgs[i].color=this.msgs[i].color||this._getRandomColor();else(t+=1)===this.msgStackLength&&(window.cancelAnimationFrame(this.requestAnimationFrameId),this.isRunning=!1)}},{key:"_start",value:function(){var t=this;this.isRunning=!0,this._draw(),this.requestAnimationFrameId=window.requestAnimationFrame(function(){return t._start()})}},{key:"pushMessage",value:function(t){if(!this.isClose){for(var i=0;i<this.msgStackLength;i++)if(!this.msgs[i]){this.msgs[i]=t;break}this.isRunning||this._start()}}},{key:"clear",value:function(){this.isRunning&&(window.cancelAnimationFrame(this.requestAnimationFrameId),this.isRunning=!1),this.ctx.clearRect(0,0,this.width,this.height),this.msgs=this.msgs.map(function(t){return null})}},{key:"close",value:function(){this.isClose||(this.isClose=!0,this.clear(),window.cancelAnimationFrame(this.requestAnimationFrameId))}},{key:"open",value:function(){this.isClose=!1,this.isRunning||this._start()}}]),o}();