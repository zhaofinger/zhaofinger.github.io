"use strict";function _classCallCheck(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,s){for(var e=0;e<s.length;e++){var i=s[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(s,e,i){return e&&t(s.prototype,e),i&&t(s,i),s}}(),Barrage=function(){function t(s){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;_classCallCheck(this,t),this.ctx=s.getContext("2d"),this.width=s.width,this.height=s.height,this.msgs=new Array(e),this.msgStackLength=e,this.quality=i,this.intervalId="",this.isRunning=!1,this.ctx.font='30px "PingFang SC", "Microsoft JhengHei", "Microsoft YaHei", "sans-serif"',this.ctx.shadowBlur=2}return _createClass(t,[{key:"_getLimitRandom",value:function(t,s){return Math.floor(Math.random()*(s-t)+t)}},{key:"_getRandomColor",value:function(){var t=["00","33","66","99","cc","ff"],s=t.length;return"#"+t[this._getLimitRandom(0,s)]+t[this._getLimitRandom(0,s)]+t[this._getLimitRandom(0,s)]}},{key:"_draw",value:function(){var t=this;this.isRunning||(this.intervalId=setInterval(function(){t.ctx.clearRect(0,0,t.width,t.height),t.ctx.save();for(var s=0,e=0;e<t.msgStackLength;e++)if(t.msgs[e])if(t.isRunning=!0,t.msgs[e].left||"number"==typeof t.msgs[e].left)if(t.msgs[e].left<0-t.msgs[e].width)t.msgs[e]=null;else{t.msgs[e].left=parseInt(t.msgs[e].left-t.msgs[e].speed),t.ctx.shadowColor=t.msgs[e].color,t.ctx.fillStyle=t.msgs[e].color,t.ctx.fillText(t.msgs[e].text,t.msgs[e].left,t.msgs[e].top);var i=t.ctx.measureText(t.msgs[e].text);t.msgs[e].width=i.width,t.ctx.restore}else t.msgs[e].left=t.width,t.msgs[e].top=t.msgs[e].top||t._getLimitRandom(30,t.height-30),t.msgs[e].speed=t.msgs[e].speed||t._getLimitRandom(2,4),t.msgs[e].color=t.msgs[e].color||t._getRandomColor();else(s+=1)===t.msgStackLength&&(clearInterval(t.intervalId),t.isRunning=!1)},this.quality))}},{key:"pushMessage",value:function(t){for(var s=0;s<this.msgStackLength;s++)if(!this.msgs[s]){this.msgs[s]=t;break}this._draw()}},{key:"clear",value:function(){this.isRunning&&(clearInterval(this.intervalId),this.isRunning=!1),this.ctx.clearRect(0,0,this.width,this.height),this.msgs=this.msgs.map(function(t){return null})}}]),t}();